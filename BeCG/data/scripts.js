var suiteOK=!1,attenteOK=!1,connectOK=!1,scale_baOK=!1,scale_ba=0,scale_bfOK=!1,scale_bf=0,chkRefresh_oldstate=!0,LANG=null;function get_lang(){const e=window.location.pathname.split("/");return console.log(e),e[e.length-2]=="en"?"en":"fr"}function index_onload(){LANG=get_lang(),get_settings(),setTimeout(function(){XMLHttpRequest_get("/getvalues")},500),["cg_voulu","masse_lest","levier_lest"].forEach(function(e){document.getElementById(e).addEventListener("focusin",function(e){e.target.select()})}),["cg_voulu","masse_lest","levier_lest"].forEach(function(e){document.getElementById(e).addEventListener("beforeinput",function(e){forceNumeric(e)})}),["cg_voulu","masse_lest","levier_lest"].forEach(function(e){document.getElementById(e).addEventListener("input",function(e){var t=e.target,n=document.getElementById("info_"+e.target.id);t.last_input=Date.now(),calcul_centrage()})}),["cg_voulu","masse_lest","levier_lest"].forEach(function(e){document.getElementById(e).addEventListener("change",function(e){var t=e.target;t.value=parseFloat(t.value).toFixed(1)})})}function calcul_centrage(){var u,h,s=document.getElementById("cg_voulu"),t=document.getElementById("masse_lest"),n=document.getElementById("levier_lest"),i=document.getElementById("info_cg_voulu"),r=document.getElementById("info_masse_lest"),a=document.getElementById("info_levier_lest"),d=parseFloat(document.getElementById("cg_mesure").value),l=parseFloat(document.getElementById("masse_mesure").value),e=parseFloat(s.value),o=parseFloat(t.value),c=parseFloat(n.value);s.hasOwnProperty("last_input")||(s.last_input=0),t.hasOwnProperty("last_input")||(t.last_input=0),n.hasOwnProperty("last_input")||(n.last_input=0),s.last_input<t.last_input&&s.last_input<n.last_input?o!==0&&c!==0&&(LANG=="en"?(i.innerText="Computed value",r.innerText="Input value",a.innerText="Input value"):(i.innerText="Valeur calculée",r.innerText="Valeur saisie",a.innerText="Valeur saisie"),u=d*l,h=c*o,e=(u+h)/(l+o),s.value=e.toFixed(1)):t.last_input<s.last_input&&t.last_input<n.last_input?e!==0&&c.value!==0&&(LANG=="en"?(i.innerText="Input value",r.innerText="Computed value",a.innerText="Input value"):(i.innerText="Valeur saisie",r.innerText="Valeur calculée",a.innerText="Valeur saisie"),o=l*(d-e)/(e-c),t.value=o.toFixed(1)):n.last_input<s.last_input&&n.last_input<t.last_input&&e!==0&&o!==0&&(LANG=="en"?(i.innerText="Input value",r.innerText="Input value",a.innerText="Computed value"):(i.innerText="Valeur saisie",r.innerText="Valeur saisie",a.innerText="Valeur calculée"),c=(e*l+e*o-d*l)/o,n.value=c.toFixed(1))}function netconfig_onload(){get_settings(),get_networks()}function forceNumeric(e){!/^[+\-\d]*\.?-?\+?\d*$/.test(e.data)&&e.data!==null?e.preventDefault():e.data=="."&&/\./.test(e.target.value)?e.preventDefault():e.data=="+"&&/[-+]/.test(e.target.value)?e.preventDefault():e.data=="-"&&/[-+]/.test(e.target.value)&&e.preventDefault()}function forceInteger(e){!/^\d*$/.test(e.data)&&e.data!==null?e.preventDefault():e.data=="."&&/\./.test(e.target.value)&&e.preventDefault()}function settings_onload(){["paf_ba","entraxe"].forEach(function(e){document.getElementById(e).addEventListener("beforeinput",function(e){forceNumeric(e)})}),document.getElementById("tare").addEventListener("beforeinput",function(e){forceInteger(e)}),document.getElementById("paf_ba").addEventListener("focusin",function(e){e.target.select()}),document.getElementById("entraxe").addEventListener("focusin",function(e){e.target.select()}),document.getElementById("tare").addEventListener("focusin",function(e){e.target.select()}),get_settings(),document.getElementById("paf_ba").focus()}function get_settings(){XMLHttpRequest_get("/getversion"),XMLHttpRequest_get("/getwifi"),XMLHttpRequest_get("/getsettings")}async function get_networks(){var e,t=document.getElementById("dlgMask0");for(t.classList.remove("noshow"),e=document.getElementById("attente0"),e.classList.remove("noshow"),attenteOK=!1,XMLHttpRequest_get("/getnetworks");!attenteOK;)await sleep(100);attenteOK=!1,e.classList.add("noshow"),t.classList.add("noshow")}function setNetworkList(e){var s,o,t="",a="",r=0,n="",c="",i="",l=document.getElementById("networkTable"),t=`<table class="netTables">
`;if(t+=`  <thead>
`,t+=`    <tr>
`,t+=`      <th>&nbsp;</th>
`,t+=`      <th>SSID</th>
`,LANG=="en"?(t+=`      <th>Channel</th>
`,t+=`      <th>Security</th>
`):(t+=`      <th>Canal</th>
`,t+=`      <th>Sécurité</th>
`),t+=`    </tr>
`,t+=`  </thead>
`,t+=`  <tbody>
`,s=e.getElementsByTagName("network"),s.length>0)for(o=0;o<s.length;o++)a=s[o].getElementsByTagName("SSID")[0].childNodes[0].nodeValue,r=s[o].getElementsByTagName("channel")[0].childNodes[0].nodeValue,n=s[o].getElementsByTagName("RSSI")[0].childNodes[0].nodeValue,c=s[o].getElementsByTagName("encryption")[0].childNodes[0].nodeValue,n<=-90?i="/signal0.svg":n>-90&&n<=-80?i="/signal1.svg":n>-80&&n<=-70?i="/signal2.svg":n>-70&&n<=-67?i="/signal3.svg":n>-67&&(i="/signal4.svg"),t+=`    <tr class="trlink" onclick="wifi_connect('`+a+"' , '"+r+`')">
`,t+='      <td class="centreVertical"><img src="'+i+'" title="RSSI = '+n+`" /></td>
`,t+="      <td>"+a+`</td>
`,t+="      <td>"+r+`</td>
`,t+="      <td>"+c+`</td>
`,t+=`    </tr>
`;else t+=`    <tr>
`,LANG=="en"?t+='      <td colspan="4">No network available</td>':t+='      <td colspan="4">Aucun réseau disponible</td>',t+=`    </tr>
`;t+=`  </tbody>
`,t+=`</table>
`,l.innerHTML=t}async function wifi_connect(e,t){var n="",i=document.getElementById("ssid_input"),s=document.getElementById("pwd_input"),o=document.getElementById("attente0"),a=document.getElementById("btnConnect"),r=document.getElementById("btnAnnuler");for(i.value=e+" (ch."+t+")",connectOK=!0,suiteOK=!1,afficheDialog("dlgConnect"),s.focus();!suiteOK;)await sleep(100);suiteOK=!1,connectOK?(n=s.value,a.disabled=!0,r.disabled=!0,o.classList.remove("noshow"),XMLHttpRequest_post_wificonnect(e,n,t),setTimeout(function(){o.classList.add("noshow")},1e4),setTimeout(function(){closeDialog("dlgConnect"),location.reload()},1e4)):(alert(LANG=="en"?"Canceled connection.":"Connexion annulée."),closeDialog("dlgConnect"))}function connect_clique(){connectOK=!0,suiteOK=!0}function connect_cancel(){connectOK=!1,suiteOK=!0}function connect_keyup(e){e.keyCode===13?document.getElementById("btnConnect").click():e.keyCode===27&&document.getElementById("btnAnnuler").click()}function deconnect_clique(){var e="";LANG=="en"?e=`Do you really want to disconnect from the current network
and clear the client WiFi settings in the balance?`:e=`Voulez-vous vraiment vous déconnecter du réseau en cours
et effacer les paramètres WiFi client dans la balance ?`,confirm(e)&&XMLHttpRequest_get("/deconnexion")}function XMLHttpRequest_post_wificonnect(e,t,n){var o,i,s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState==4&&(s.status==200||s.status==0?XMLHttpResult("wificonnect",s.responseXML,s.responseText):alert("XMLHttpRequest_post_wificonnect() : Error "+s.status))},o=encodeURIComponent(e),i=encodeURIComponent(t),s.open("POST","/wificonnect",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("ssid="+o+"&pwd="+i+"&channel="+n)}function XMLHttpRequest_post_settings(){var t=document.getElementById("paf_ba").value,n=document.getElementById("entraxe").value,s=document.getElementById("tare").value,e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState==4&&(e.status==200||e.status==0?XMLHttpResult("/setsettings",e.responseXML,e.responseText):alert("XMLHttpRequest_post_settings() : Error "+e.status))},e.open("POST","/setsettings",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("paf_ba="+t+"&entraxe="+n+"&tare="+s)}function XMLHttpRequest_get(e){var t,n,s=document.getElementById("heure");s!=null&&(n=new Date(Date.now()),s.textContent=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds()),t=new XMLHttpRequest,t.onreadystatechange=function(){t.readyState==4&&(t.status==200||t.status==0?XMLHttpResult(e,t.responseXML,t.responseText):alert("XMLHttpRequest_get("+e+") : Error "+t.status))},t.open("GET",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}function XMLHttpResult(e,t){if(t!=null)if(e=="/getversion"){var s,o,i,a,r,c,l,d,u,h,m,f,g,v,b,j,y,_,w,O,x,C,E,k,p=t.getElementsByTagName("string")[0].childNodes[0].nodeValue,A=document.getElementById("version"),S=document.getElementById("apropos_version");A.textContent=p,S.textContent=p}else e=="/getwifi"?(v=t.getElementsByTagName("ap_ssid")[0].childNodes[0].nodeValue,b=t.getElementsByTagName("ap_ip")[0].childNodes[0].nodeValue,c=t.getElementsByTagName("cli_ssid")[0].childNodes[0].nodeValue,i=t.getElementsByTagName("cli_ip")[0].childNodes[0].nodeValue,y=document.getElementById("ap_ssid"),l=document.getElementById("ap_ip"),h=document.getElementById("cli_ssid"),m=document.getElementById("cli_ip"),y.textContent=v,l.textContent=b,h.textContent=c,m.textContent=i,r=document.getElementById("ssidActuel"),o=document.getElementById("ipActuel"),r!=null&&(r.value=c),o!=null&&(o.value=i)):e=="/getvalues"?(u=t.getElementsByTagName("ba")[0].childNodes[0].nodeValue,O=t.getElementsByTagName("bf")[0].childNodes[0].nodeValue,f=t.getElementsByTagName("total")[0].childNodes[0].nodeValue,s=t.getElementsByTagName("cg")[0].childNodes[0].nodeValue,d=document.getElementById("ba"),_=document.getElementById("bf"),w=document.getElementById("total"),a=document.getElementById("cg"),d.textContent=u+" g",_.textContent=O+" g",w.textContent=f+" g",isNaN(s)?a.textContent=s:a.textContent=s+" mm"):e=="/resetscale"?(scale_baOK=!1,scale_ba=0,scale_bfOK=!1,scale_bf=0,attenteOK=!0):e=="/tare"?attenteOK=!0:e=="/etalonba"?(scale_baOK=!0,scale_ba=t.getElementsByTagName("scale")[0].childNodes[0].nodeValue,attenteOK=!0):e=="/etalonbf"?(scale_bfOK=!0,scale_bf=t.getElementsByTagName("scale")[0].childNodes[0].nodeValue,attenteOK=!0):e=="/getsettings"||e=="/setsettings"?(x=t.getElementsByTagName("paf_ba")[0].childNodes[0].nodeValue,C=t.getElementsByTagName("entraxe")[0].childNodes[0].nodeValue,E=t.getElementsByTagName("tare")[0].childNodes[0].nodeValue,k=document.getElementById("paf_ba"),j=document.getElementById("entraxe"),g=document.getElementById("tare"),k.value=x,j.value=C,g.value=E):e=="/getnetworks"?(setNetworkList(t),attenteOK=!0):e=="/wificonnect"?(result=t.getElementsByTagName("result")[0].childNodes[0].nodeValue,result=="OK"?location.reload():alert(LANG=="en"?`Connexion error: 
`+result:`Erreur de connexion : 
`+result)):e=="/deconnexion"&&(result=t.getElementsByTagName("result")[0].childNodes[0].nodeValue,result=="OK"?(alert(LANG=="en"?"Wifi client disconnected.":"Wifi client déconnecté."),location.reload()):alert(LANG=="en"?`Disconnecting error: 
`+result:`Erreur déconnexion : 
`+result));e=="/getvalues"&&autoRefresh()}function autoRefresh(){var e=document.getElementById("auto_refresh");e.checked?(setTimeout(function(){XMLHttpRequest_get("/getvalues")},250),chkRefresh_oldstate||(XMLHttpRequest_get("/startmesure"),XMLHttpRequest_get("/affichage?reset"),chkRefresh_oldstate=!0)):chkRefresh_oldstate=!1}async function balance_tare(){var e,t=document.getElementById("dlgMask0"),n=document.getElementById("attente0");if(t.classList.remove("noshow"),e="",LANG=="en"?e="Resetting the scale to zero?":e="Remise à zéro de la balance ?",confirm(e)){for(n.classList.remove("noshow"),attenteOK=!1,XMLHttpRequest_get("/tare");!attenteOK;)await sleep(100);attenteOK=!1,n.classList.add("noshow")}t.classList.add("noshow")}function afficheDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);t.classList.remove("noshow"),window.setTimeout(function(){n.classList.remove("masquer")},.2),e=="dlgEtalonnage"&&etalonnage()}async function etalonnage(){var t=document.getElementById("attente0"),e="",s=document.getElementById("auto_refresh"),n=document.getElementById("tare").value;for(s.checked=!1,document.getElementById("btnSuite").disabled=!1,LANG=="en"?document.getElementById("btnClose").innerHTML="Cancel":document.getElementById("btnClose").innerHTML="Annuler",LANG=="en"?e='<p>Make sure the<br />scale is empty then<br />Click on "Next".</p>':e='<p>Assurez vous que la<br />balance est vide puis<br />Cliquez sur "Suivant".</p>',document.getElementById("dlgContenu0").innerHTML=e,XMLHttpRequest_get("/stopmesure"),XMLHttpRequest_get(encodeURI(LANG=="en"?"/affichage?text=Network calibration\u000Ain progress...":"/affichage?text=Etalonnage réseau\u000Anen cours..."));!suiteOK;)await sleep(100);for(suiteOK=!1,LANG=="en"?document.getElementById("btnClose").innerHTML="Close":document.getElementById("btnClose").innerHTML="Fermer",document.getElementById("btnClose").disabled=!0,LANG=="en"?e="<p>Resetting<br />the scales...</p>":e="<p>Remise à zéro<br />des balances...</p>",document.getElementById("dlgContenu0").innerHTML=e,t.classList.remove("noshow"),attenteOK=!1,XMLHttpRequest_get("/resetscale");!attenteOK;)await sleep(100);for(attenteOK=!1,XMLHttpRequest_get("/tare");!attenteOK;)await sleep(100);for(attenteOK=!1,t.classList.add("noshow"),XMLHttpRequest_get(encodeURI(LANG=="en"?"/affichage?text=Network calibration\u000Ain progress...":"/affichage?text=Etalonnage réseau\u000Anen cours...")),LANG=="en"?e="<p>Place a weight of<br />"+n+' g on the scale<br />on the leading edge side, then<br />Click on "Next".</p>':e="<p>Placez une masse de<br />"+n+` g sur la balance<br />coté bord d'attaque, puis<br />Cliquez sur "Suivant".</p>`,document.getElementById("dlgContenu0").innerHTML=e;!suiteOK;)await sleep(100);for(suiteOK=!1,LANG=="en"?e="<p>Tare measurement<br />leading edge...</p>":e="<p>Mesure de la tare<br />bord d'attaque...</p>",document.getElementById("dlgContenu0").innerHTML=e,t.classList.remove("noshow"),attenteOK=!1,XMLHttpRequest_get("/etalonba");!attenteOK;)await sleep(100);for(attenteOK=!1,t.classList.add("noshow"),XMLHttpRequest_get(encodeURI(LANG=="en"?"/affichage?text=Network calibration\u000Ain progress...":"/affichage?text=Etalonnage réseau\u000Anen cours...")),LANG=="en"?e="<p>Place a weight of<br />"+n+' g on the scale<br />on the trailing edge side, then<br />Click on "Next".</p>':e="<p>Placez une masse de<br />"+n+' g sur la balance<br />coté bord de fuite, puis<br/>Cliquez sur "Suivant".</p>',document.getElementById("dlgContenu0").innerHTML=e;!suiteOK;)await sleep(100);for(suiteOK=!1,LANG=="en"?e="<p>Tare measurement<br />trailing edge...</p>":e="<p>Mesure de la tare<br />bord de fuite...</p>",document.getElementById("dlgContenu0").innerHTML=e,t.classList.remove("noshow"),attenteOK=!1,XMLHttpRequest_get("/etalonbf");!attenteOK;)await sleep(100);attenteOK=!1,t.classList.add("noshow"),LANG=="en"?e="<p>Calibration completed,<br />- nscale_ba = "+scale_ba+"<br />- nscale_bf = "+scale_bf+"</p>":e="<p>Etalonnage terminé,<br />- nscale_ba = "+scale_ba+"<br />- nscale_bf = "+scale_bf+"</p>",document.getElementById("dlgContenu0").innerHTML=e,XMLHttpRequest_get("/affichage?reset"),XMLHttpRequest_get("/startmesure"),document.getElementById("btnSuite").disabled=!0,document.getElementById("btnClose").disabled=!1,s.checked=!0}function suite_clique(){suiteOK=!0}function sleep(e){return new Promise(t=>setTimeout(t,e))}function closeDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);n.classList.add("masquer"),window.setTimeout(function(){t.classList.add("noshow")},1)}function reboot(){var e=document.getElementById("dlgMask0"),t=document.getElementById("attente0");e.classList.remove("noshow"),t.classList.remove("noshow"),confirm("Redémarrer la balance ?")?(XMLHttpRequest_get("/reboot"),setTimeout(function(){document.location.replace("/")},15e3)):(e.classList.add("noshow"),t.classList.add("noshow"))}function onglet_click(e){var t,n,s=document.getElementById("onglet1"),o=document.getElementById("onglet2"),i=document.getElementById("calculs"),a=document.getElementById("mesures");e=="onglet1"?(s.classList.add("selected"),o.classList.remove("selected"),a.classList.remove("noshow"),i.classList.add("noshow")):e=="onglet2"&&(s.classList.remove("selected"),o.classList.add("selected"),a.classList.add("noshow"),i.classList.remove("noshow"),t=parseFloat(document.getElementById("cg").textContent),isNaN(t)&&(t=0),n=parseFloat(document.getElementById("total").textContent),isNaN(n)&&(n=0),document.getElementById("cg_mesure").value=t.toFixed(1),document.getElementById("masse_mesure").value=n.toFixed(1),document.getElementById("cg_voulu").value=t.toFixed(1))}function sauvegarder(){if(fileName=window.prompt("Entrez le nom du fichier à sauvegarder","BeCG"),fileName!==null){const t=document.createElement("a");var e="";e+="Position CG mesurée (mm/ba),"+document.getElementById("cg_mesure").value+`
`,e+="Masse mesurée (g),"+document.getElementById("masse_mesure").value+`
`,e+="Position CG désirée (mm/ba),"+document.getElementById("cg_voulu").value+","+document.getElementById("info_cg_voulu").innerText+`
`,e+="Masse du lest (g),"+document.getElementById("masse_lest").value+","+document.getElementById("info_masse_lest").innerText+`
`,e+="Bras de levier du lest (mm/ba),"+document.getElementById("levier_lest").value+","+document.getElementById("info_levier_lest").innerText+`
`;const n=new Blob([e],{type:"data:text/csv;charset=utf-8"});t.href=URL.createObjectURL(n),t.download=fileName+".csv",t.click(),URL.revokeObjectURL(t.href),t.remove()}}function showApropos(){var e=document.getElementById("dlgMask1"),t=document.getElementById("dlgApropos");e.classList.remove("noshow"),window.setTimeout(function(){t.classList.remove("masquer")},.25)}function closeApropos(){var e=document.getElementById("dlgMask1"),t=document.getElementById("dlgApropos");t.classList.add("masquer"),window.setTimeout(function(){e.classList.add("noshow")},.25)}function changeLang(e){e=="en"?location.href="/setlang?lang=en":location.href="/setlang?lang=fr"}